name: kadas-qgis
sources:
  - type: git
    url: https://github.com/kadas-albireo/QGIS.git
    tag: final-3_28_8-kadas
  - type: shell
    commands:
      - git grep -l '${Python_SITEARCH}' | xargs sed -i 's/\${Python_SITEARCH}/\/app\/lib\/python3.10\/site-packages/g' #crude fix for forcing cmake setting site-packages to /app instead of /usr
      - sed -i 's/sysconfig.get_path.*/"\/app\/lib\/python3.10\/site-packages"/g' cmake/FindSIP.py #force install sip files to /app instead of /usr
buildsystem: cmake-ninja
builddir: true
config-opts:
  - "-DCMAKE_BUILD_TYPE=Release"
  - "-DCMAKE_INSTALL_PREFIX=/app"
  - "-DCMAKE_PREFIX_PATH=/app;/usr"
  - "-DUSE_CCACHE=ON"
  - "-DBINDINGS_GLOBAL_INSTALL=TRUE" #solved with python_sitearch fix
  - "-DSIP_GLOBAL_INSTALL=TRUE" #analysis.sip needed by kadas, solved with findsip.py fix
  - "-DENABLE_TESTS=FALSE"
